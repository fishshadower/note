<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>希曦的小屋</title>
    <script src="./js/anime.min.js"></script>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="./css/house.css">
</head>

<body>
    <!-- 自定义鼠标指针 -->
    <img src="./image/cursor.png" alt="Custom Cursor" class="custom-cursor" id="customCursor">

    <!-- 透明卡片，人物脸部触发 -->
    <div class="face_card" id="face_card"></div>

    <div id="musicBtn" class="music-btn clickable">
        <img id="musicIcon" src="./image/音乐关.png" alt="Music Icon">
    </div>

    <div class="main">
        <img src="./image/house/咒语背景墙@2x.png" alt="" class="house_background" id="house_background">

        <img src="./image/house/柜子@2x.png" alt="" class="cabinet" id="cabinet">

        <img src="./image/house/大蜘蛛@2x.png" alt="" class="big_spider" id="big_spider">
        <img src="./image/house/小蜘蛛@2x.png" alt="" class="small_spider" id="small_spider">

        <!-- 让触手作为窗户的子元素 -->
        <div class="window-container">
            <img src="./image/house/窗户@2x.png" alt="窗户" class="thewindow" id="thewindow">
            <!-- <img src="./image/house/触手@2x.png" alt="触手" class="hand" id="hand"> -->
            <img src="./image/house/触手.gif" alt="触手" class="hand" id="hand">
        </div>

        <img src="./image/house/面具眨眼.gif" alt="" class="mask" id="mask">
        <img src="./image/house/对话框.gif" alt="" class="think_more" id="think_more">
        <!-- <img src="./image/house/技能卡片动画.gif" alt="" class="mask_active" id="mask_active"> -->
        <img src="./image/house/技能卡片动画_白边.gif" alt="" class="mask_active" id="mask_active">

        <img src="./image/house/桌子@2x.png" alt="" class="thetable" id="thetable">
        <img src="./image/house/骷髅.gif" alt="" class="hedgehog" id="hedgehog">

        <img src="./image/house/左-杯子.gif" alt="" class="hedgehog_left" id="hedgehog_left">
        <img src="./image/house/右-杯子.gif" alt="" class="hedgehog_right" id="hedgehog_right">

        <img src="./image/house/花盆@2x.png" alt="" class="flowerpot" id="flowerpot">

        <img src="./image/house/窗帘@2x.png" alt="" class="window_curtain" id="window_curtain">

        <img src="./image/house/小灯.gif" alt="" class="light_all" id="light_all">

        <!-- <div class="light_container">
            <img src="./image/house/灯1@2x.png" alt="" class="light_1" id="light_1">
            <img src="./image/house/灯2@2x.png" alt="" class="light_2" id="light_2">
            <img src="./image/house/灯3@2x.png" alt="" class="light_3" id="light_3">
            <img src="./image/house/灯4@2x.png" alt="" class="light_4" id="light_4">
            <img src="./image/house/灯5@2x.png" alt="" class="light_5" id="light_5">
            <img src="./image/house/灯6@2x.png" alt="" class="light_6" id="light_6">
            <img src="./image/house/灯7@2x.png" alt="" class="light_7" id="light_7">
            <img src="./image/house/灯8@2x.png" alt="" class="light_8" id="light_8">
        </div> -->


        <img src="./image/house/链子和小灯珠@2x.png" alt="" class="chain" id="chain">

        <img src="./image/house/灯光@2x.png" alt="" class="light" id="light">

        <!-- 猫和书 -->
        <div class="cat-book">
            <img src="./image/house/猫.png" alt="" class="cat" id="cat">
            <img src="./image/house/汪.png" alt="" class="dog" id="dog">
            <img src="./image/house/书@2x.png" alt="" class="book" id="book">
        </div>


        <img src="./image/house/黑色前景@2x.png" alt="" class="foreground" id="foreground">

        <div class="skill_container">
            <img src="./image/house/pc.png" alt="PC" class="card clickable" data-active="./image/house/pc_active.png" data-type="pc">
            <img src="./image/house/移动端.png" alt="Phone" class="card clickable" data-active="./image/house/移动端_active.png" data-type="phone">
            <img src="./image/house/游戏.png" alt="Game" class="card clickable" data-active="./image/house/游戏_active.png" data-type="game">
            <img src="./image/house/像素.png" alt="Pixel" class="card clickable" data-active="./image/house/像素_active.png" data-type="pixel">
            <img src="./image/house/平面.png" alt="Plane" class="card clickable" data-active="./image/house/平面_active.png" data-type="plane">
            <img src="./image/house/插画.png" alt="Art" class="card clickable" data-active="./image/house/插画_active.png" data-type="art">
            <img src="./image/house/剧本杀.png" alt="Script" class="card clickable" data-active="./image/house/剧本杀_active.png" data-type="script">
            <img src="./image/house/3d.png" alt="3D" class="card clickable" data-active="./image/house/3d_active.png" data-type="3d">
        </div>

        <!-- 返回 -->
        <img src="./image/back.png" alt="Back" class="back clickable" id="back">

        <!-- 老电影效果 -->
        <img src="./image/old_movie_1.png" alt="" class="old_movie" id="old_movie_1">
        <img src="./image/old_movie_2.png" alt="" class="old_movie" id="old_movie_2">



    </div>

    <script src="./main.js"></script>
    <script>

        // 返回
        const back = document.getElementById('back');
        back.addEventListener('click', () => {
            window.location.href = './welcome.html';
        });

        // 卡片激活
        document.addEventListener('DOMContentLoaded', function () {
            const cards = document.querySelectorAll('.card');

            // 预加载所有激活图片
            cards.forEach(card => {
                new Image().src = card.dataset.active;
            });

            cards.forEach(card => {
                const originalSrc = card.src;
                const activeSrc = card.dataset.active;

                let isHovered = false; // 标记当前是否处于 hover 状态
                let isImageLoaded = false; // 标记激活图片是否已加载完成

                card.addEventListener('mouseenter', () => {
                    isHovered = true; // 标记 hover 状态
                    card.src = activeSrc; // 切换图片

                    // 如果图片已经加载完成，直接应用放大效果
                    if (card.complete) {
                        isImageLoaded = true;
                        card.style.transform = 'scale(1.4)';
                        card.style.zIndex = 10;
                    } else {
                        // 监听图片加载完成事件
                        card.addEventListener('load', () => {
                            isImageLoaded = true;
                            if (isHovered) { // 确保 hover 状态仍然有效
                                card.style.transform = 'scale(1.4)';
                                card.style.zIndex = 10;
                            }
                        }, { once: true });
                    }
                });

                card.addEventListener('mouseleave', () => {
                    isHovered = false; // 取消 hover 状态
                    isImageLoaded = false; // 重置图片加载状态

                    // 先切换回原始图片
                    card.src = originalSrc;

                    // 强制浏览器重绘，避免闪烁
                    void card.offsetWidth;

                    // 缩小图片
                    card.style.transform = 'scale(1)';

                    // 恢复层级
                    card.style.zIndex = 8;
                });
            });

            // 点击卡片跳转并传参
            cards.forEach(card => {
                card.addEventListener('click', () => {
                    const type = card.dataset.type; // 读取自定义参数
                    const url = `./works.html?type=${encodeURIComponent(type)}`;
                    window.location.href = url;
                });
            });
        });

          // 老电影效果
          document.addEventListener('DOMContentLoaded', function () {
            const movie1 = document.getElementById('old_movie_1');
            const movie2 = document.getElementById('old_movie_2');
            let isMovie1Visible = true;

            setInterval(() => {
                if (isMovie1Visible) {
                    movie1.style.display = 'none';
                    movie2.style.display = 'block';
                } else {
                    movie1.style.display = 'block';
                    movie2.style.display = 'none';
                }
                isMovie1Visible = !isMovie1Visible;
            }, 200); // 每 200ms 切换一次
        });

        // 猫和狗
        document.addEventListener("DOMContentLoaded", function () {
            const cat = document.getElementById('cat');
            const dog = document.getElementById('dog');
            const catbook = document.querySelector('.cat-book'); // 修改为正确的 class 选择器

            if (catbook) {
                catbook.addEventListener('mouseenter', function () {
                    cat.style.opacity = '0';
                    cat.style.visibility = 'hidden';
                    dog.style.opacity = '1';
                    dog.style.visibility = 'visible';
                });

                catbook.addEventListener('mouseleave', function () {
                    cat.style.opacity = '1';
                    cat.style.visibility = 'visible';
                    dog.style.opacity = '0';
                    dog.style.visibility = 'hidden';
                });
            }
        });


        // 蜘蛛收缩
        document.addEventListener("DOMContentLoaded", function () {
            const bigSpider = document.getElementById("big_spider");
            const smallSpider = document.getElementById("small_spider");

            bigSpider.addEventListener("mouseenter", function () {
                bigSpider.src = "./image/house/大蜘蛛缩小.png"; // 切换缩小图片
                bigSpider.style.pointerEvents = "none"; // 禁止鼠标事件，防止闪烁

                setTimeout(() => {
                    bigSpider.src = "./image/house/大蜘蛛@2x.png"; // 1.5 秒后恢复原来的图片
                    bigSpider.style.pointerEvents = "auto"; // 恢复鼠标事件
                }, 1500);
            });

            smallSpider.addEventListener("mouseenter", function () {
                smallSpider.src = "./image/house/小蜘蛛缩小.png";
                smallSpider.style.pointerEvents = "none";

                setTimeout(() => {
                    smallSpider.src = "./image/house/小蜘蛛@2x.png";
                    smallSpider.style.pointerEvents = "auto";
                }, 1500);
            });
        });

        // 透明卡片，人物脸部触发
        // 鼠标移入，人物变为摘下面具的图片，同时thinkmoregif隐藏， 鼠标移出，人物恢复，thinkmoregif显示
        document.addEventListener("DOMContentLoaded", function () {
            const faceCard = document.getElementById("face_card");
            const mask = document.getElementById("mask");
            const thinkMore = document.getElementById("think_more");
            const maskActive = document.getElementById("mask_active");
            faceCard.addEventListener("mouseenter", function () {
                mask.style.display = "none";
                thinkMore.style.display = "none";
                maskActive.style.display = "block";
            });
            faceCard.addEventListener("mouseleave", function () {
                mask.style.display = "block";
                thinkMore.style.display = "block";
                maskActive.style.display = "none";
            });
        });

        // 播放背景音乐
        document.addEventListener('DOMContentLoaded', function () {
            const musicBtn = document.getElementById('musicBtn');
            const musicIcon = document.getElementById('musicIcon');
            const backgroundMusic = new Audio('./mp3/小屋音乐.mp3');
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.5;

            let isPlaying = false;
            let hasUserInteracted = false;

            const updateIcon = () => {
                musicIcon.src = isPlaying ? './image/音乐开.png' : './image/音乐关.png';
            };

            // 点击按钮控制音乐
            musicBtn.addEventListener('click', function (event) {
                event.stopPropagation();

                if (!isPlaying) {
                    backgroundMusic.play()
                        .then(() => {
                            isPlaying = true;
                            updateIcon();
                        })
                        .catch(err => {
                            console.warn("⚠️ 播放失败：", err);
                        });
                } else {
                    backgroundMusic.pause();
                    isPlaying = false;
                    updateIcon();
                }
            });

            // 首次点击任意地方自动播放
            const startMusic = () => {
                if (!hasUserInteracted) {
                    backgroundMusic.play()
                        .then(() => {
                            isPlaying = true;
                            hasUserInteracted = true;
                            updateIcon();
                            console.log("🎵 首次点击自动播放成功");
                        })
                        .catch(err => {
                            console.warn("⚠️ 首次自动播放失败：", err);
                        });

                    document.removeEventListener('click', startMusic);
                }
            };

            document.addEventListener('click', startMusic);
        });

    </script>
</body>

</html>